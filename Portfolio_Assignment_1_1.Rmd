---
title: "Portfolio Assignment 1.1"
author: "Shervin Kaandorp"
date: "14-4-2021"
output: html_document
---
```{R Setup, include=FALSE}
library(tidyverse)
library(readxl)
library(here)
```

## Lesson 1

### Portfolio Assignment 1.1

_A) Review the following Excel file in the ./data/CE.LIQ.FLOW.062_Tidydata.xlsx (itâ€™s here), by opening the file in Excel. See if you can spot anything peculiar about this file. Do not edit the file in any way. Just close it when you are done. (Annoyingly, Excel asks you to save your changes, even if you did not touch anything in the file: why is this cumbersome?)_

There are some values missing in the "RawData" column in row 192-196. RawData, compName, compConcentration and the expType column all have a General format in Excel. While it is expected that they have a text format. Cell P260 has a comma instead of a dot.

_B) Open the file in R, using the {readxl} package. _

The _here_ package has also been used to import the excel file from the working directory.

```{R Assignment 1.1B, message=FALSE}
CE.LIQ.FLOW.062_Tidydata <- read_excel(here("rawdata/CE.LIQ.FLOW.062_Tidydata.xlsx"))
```

_C) Inspect the data types of columns RawData, compName and compConcentration. What types would you expect from the experimental description above. Have the data types been correctly assigned during the importing of the data into R? _

```{R Assignment 1.1C}
as_tibble(CE.LIQ.FLOW.062_Tidydata) %>% select("RawData","compName","compConcentration") %>% str()
```

The data of the "RawData" and "compName" columns have been assinged correctly. Nonetheless, the data type for "compConcentration" has been assinged incorrectly. This should have been numeric instead of character.

_D) Create a graph displaying a scatterplot for the CE.LIQ.FLOW.062_Tidydata.xlsx data, for the different compounds and the varying concentrations. Put the compConcentration on the x-axis, the DataRaw counts on the y-axis and assign a colour to each level in compName. Assign a different symbol (shape =) to each level in the expType variable. Try fixing the labels of the x-axis so that we can read them. _

```{R Assignment 1.1D, warning=FALSE}
CE.LIQ.FLOW.062_Tidydata$compConcentration <- 
  gsub(",", ".", CE.LIQ.FLOW.062_Tidydata$compConcentration) # Resolving issue comma in cell P260.

CE.LIQ.FLOW.062_Tidydata$compConcentration <- as.numeric(CE.LIQ.FLOW.062_Tidydata$compConcentration, na.rm=TRUE) # Change type of compConcentration to numeric

ggplotCLF.062 <- CE.LIQ.FLOW.062_Tidydata %>% 
  ggplot(aes(x=compConcentration,y=RawData,shape=expType,colour=compName)) +
  geom_point() +
  labs(x= "Compound Concentration (nM)",
       y= "Number of offspring",
       title= "Number of offsprings of C.elegans after incubating in a compound",
       caption= "the dataset CE.LIQ.FLOW.062_Tidydata has been used",
       shape="Experiment Type",
       colour="Compound") # Creating graph

ggplotCLF.062
```

_E) When creating the plot under C), what happened with the ordering of the x-axis labels. Explain why this happens. Look at the data-type of the compConcentration column in the data again to find a clue._

This issue has been resolved using the as.numeric function. If this function wasn't used to make this variable numeric, it would still be a character variable and the x-axis wouldn't be sorted.

_F) Correct the data-type of compConcentration to numeric and than look at the graph again. Use a log10 transformation on the x-axis to get a clear graph. Also, add a bit of jitter to the points in the graph so that points are not overlapping._

Because the data-type of "compConcentration" was already made numeric in assignment 1.1D, there will only be a log10 transformation of the x-axis and a jitter.

```{R Assignment 1.1F, warning=FALSE} 
ggplotCLF.062 + 
  scale_x_continuous(trans = "log10") + 
  geom_jitter(width=0.15) + 
  labs(caption="the dataset CE.LIQ.FLOW.062_Tidydata has been used and a jitter of 0.15 has been added.")
````

_G and H) Fill in. _

The positive control for this experiment is Ethanol and the negative control for this experiment is S-medium.

_I) Think about how you would analyze this experiment to learn whether there is indeed an effect of different concentrations on offspring count and whether the different compounds have a different curve (IC50). Write down you analysis as a step-wise plan._

To analyze the data, these steps should be performed:

1. The mean offspring of each concentration of each compound should be calculated.
2. The mean offspring of each concentration of each compound should be normalized with the mean offspring of the negative control.
3. Now, a IC50 curve can be made depicting the concentration of the compound on the x-axis and the relative offspring on the y-axis.
4. Additional significance tests are performed to examine a possible significant difference.

_J) Normalize the data for the controlNegative in such a way that the mean value for controlNegative is exactly equal to 1 and that all other values are expressed as a fraction thereof. Rerun your graphs with the normalized data._

```{R Assignment 1.1J, warning=FALSE, message=FALSE}
CE.LIQ.FLOW.062_means <- CE.LIQ.FLOW.062_Tidydata %>%
  group_by(compName,compConcentration, expType) %>% 
  summarize(mean=mean(RawData, na.rm=TRUE)) # Calculating mean

S_medium_neg <- CE.LIQ.FLOW.062_means %>% 
  filter(compName=="S-medium")
negative_cont <- S_medium_neg[4] # Retrieving negative control mean

CE.LIQ.FLOW.062_means <- CE.LIQ.FLOW.062_means %>% 
  mutate(relative_offspring=mean/negative_cont*100) # Adding relative offspring count

CE.LIQ.FLOW.062_means %>%
  ggplot(aes(x=compConcentration,y=relative_offspring$mean,shape=expType,colour=compName)) +
  geom_point() +
  labs(x= "Compound Concentration (nM)",
       y= "Relative number of offspring (%)",
       title= "Relative C.elegans offspring after incubating in a compound",
       caption= "the dataset CE.LIQ.FLOW.062_Tidydata has been used, 
       and the offspring count have been normalized for the negative control.",
       shape="Experiment Type",
       colour="Compound") +
  scale_x_continuous(trans = "log10") # Creating graph
```

_K) Why would you want to take the step under J?_

To see whether or not there are significant differences, significance tests should be performed. Also a IC50 Curve can be made to visualize the data.